# Auth & Access Control System

Backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** –∏ **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** –Ω–∞ –±–∞–∑–µ **FastAPI + SQLAlchemy + PostgreSQL**.  
–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –∞ —Ç–∞–∫–∂–µ –≥–∏–±–∫—É—é –º–æ–¥–µ–ª—å —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º.

---

## üìå –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–§–ò–û, email, –ø–∞—Ä–æ–ª—å).
- –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (**login**) –ø–æ email –∏ –ø–∞—Ä–æ–ª—é.
- –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (**logout**) —Å –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞.
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è.
- –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (`is_active=False`).
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (`bcrypt`).
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **JWT** (access + refresh —Ç–æ–∫–µ–Ω—ã) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **revocation** —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `sessions`.
- **Refresh-—Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º HTTP-only cookie** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `access`-—Ç–æ–∫–µ–Ω–∞.

### üîí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è **—Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø–∞**:
  - `roles` ‚Äî —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin, manager, user, guest).
  - `business_objects` ‚Äî –æ–±—ä–µ–∫—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã –∏ —Ç.–ø.).
  - `access_rules` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ (—á—Ç–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ ‚Äî —Å–≤–æ–∏/—á—É–∂–∏–µ –∑–∞–ø–∏—Å–∏).
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ dependency `require_permission(...)`.
- –û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞:
  - `401 Unauthorized` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.
  - `403 Forbidden` ‚Äî —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è.

### üõ† Mock-–æ–±—ä–µ–∫—Ç—ã
–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –µ—Å—Ç—å **—Ç–µ—Å—Ç–æ–≤—ã–µ –±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç—ã**, –∫ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞.  
–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `admin` –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –∞ `user` ‚Äî —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏.

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [FastAPI](https://fastapi.tiangolo.com/) ‚Äî REST API
- [SQLAlchemy + Alembic](https://www.sqlalchemy.org/) ‚Äî ORM –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- [PostgreSQL](https://www.postgresql.org/) ‚Äî –ë–î
- [bcrypt](https://pypi.org/project/bcrypt/) ‚Äî —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- [python-jose](https://python-jose.readthedocs.io/) ‚Äî —Ä–∞–±–æ—Ç–∞ —Å JWT
- [Docker + docker-compose](https://www.docker.com/) ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- [nginx](https://nginx.org/) ‚Äî reverse proxy
- [GitHub Actions](https://github.com/features/actions) ‚Äî CI/CD

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/AlexXxShurik/AuthExample
cd project
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤—Å—Ç–∞–≤—å —Ç—É–¥–∞ –ø—Ä–∏–º–µ—Ä:

```env
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=465
SMTP_USERNAME=email@example.com
SMTP_PASSWORD=#################

POSTGRES_USER=postgres
POSTGRES_PASSWORD=secret_password
POSTGRES_DB=postgres
POSTGRES_HOST=db
POSTGRES_PORT=5432

SECRET_KEY=super-secret-key
ALGORITHM=HS256

ACCESS_TOKEN_EXPIRE_MINUTES=60
VERIFY_EMAIL_TOKEN_EXPIRE_MINUTES=1440
REFRESH_TOKEN_EXPIRE_DAYS=30
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
  docker-compose up --build
```

## –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

- **Backend**: [http://localhost:8000](http://localhost:8000)  
- **Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [http://localhost:8000/api/docs](http://localhost:8000/api/docs)


## üß© –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `admin`**  
  –ú–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å, –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å **–≤—Å–µ –∑–∞–ø–∏—Å–∏**.

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `user`**  
  –ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏**.

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ —Ä–æ–ª–∏**  
  –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É **403 Forbidden**.

## üìú –°—Ö–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º

| –¢–∞–±–ª–∏—Ü–∞            | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
|--------------------|---------------------------------------------------------------------------|
| **roles**          | –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`admin`, `manager`, `user`, `guest`).                 |
| **business_objects** | –û–±—ä–µ–∫—Ç—ã —Å–∏—Å—Ç–µ–º—ã (`users`, `orders`, `products` –∏ —Ç.–¥.).                  |
| **access_rules**   | –°–≤—è–∑—å —Ä–æ–ª–∏ —Å –æ–±—ä–µ–∫—Ç–æ–º –∏ –Ω–∞–±–æ—Ä–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (`can_read`, `can_update`, `can_delete`, ‚Ä¶). |
| **user_roles**     | –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—è–º–∏ (–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º).                          |
| **sessions**       | –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT (**revocation**).                   |

