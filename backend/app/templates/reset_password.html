<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Сброс пароля</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; }
        .form-container { max-width: 400px; margin: auto; }
        input { width: 100%; padding: 10px; margin: 0.5rem 0; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
<div class="form-container">
    <h2>Сброс пароля</h2>
    <p>Введите новый пароль:</p>
    <form id="resetForm">
        <input type="password" id="password1" placeholder="Новый пароль" required />
        <input type="password" id="password2" placeholder="Повторите пароль" required />
        <input type="hidden" id="token" value="{{ token }}" />
        <button type="submit">Сбросить пароль</button>
    </form>
    <p id="message"></p>
</div>

<script>
    const form = document.getElementById('resetForm');
    const messageEl = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const password1 = document.getElementById('password1').value;
        const password2 = document.getElementById('password2').value;
        const token = document.getElementById('token').value;

        if (password1 !== password2) {
            messageEl.textContent = "Пароли не совпадают";
            messageEl.className = "error";
            return;
        }

        try {
            const response = await fetch('/v1/users/password/reset', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: token, new_password: password1 })
            });

            const data = await response.json();
            if (response.ok) {
                messageEl.textContent = "Пароль успешно сброшен!";
                messageEl.className = "success";
            } else {
                messageEl.textContent = data.detail || "Ошибка сброса пароля";
                messageEl.className = "error";
            }
        } catch (err) {
            messageEl.textContent = "Ошибка сети";
            messageEl.className = "error";
        }
    });
</script>
</body>
</html>
